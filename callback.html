<script>
  async function exchangeCodeForTokens() {
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get("code");
    const verifier = localStorage.getItem("verifier"); // get saved key

    if (!code || !verifier) {
      console.log("Missing code or verifier");
      return;
    }

    const body = new URLSearchParams({
      grant_type: "authorization_code",
      client_id: "2f6ca3c9-87ec-4042-a464-21349485a16f",
      code: code,
      redirect_uri: "https://nathanogaga118.github.io/ultra-poc/callback.html",
      code_verifier: verifier
    });

    const res = await fetch("https://auth.staging.ultra.io/auth/realms/ultraio/protocol/openid-connect/token", {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded"
      },
      body: body.toString()
    });

    const data = await res.json();
    console.log("âœ… Access Token:", data.access_token);
  }

  exchangeCodeForTokens();
</script>
