<script>
  async function startLogin() {
    const codeVerifier = crypto.randomUUID(); // generate random key
    localStorage.setItem("verifier", codeVerifier); // save it for later

    // Turn key into a special lock
    const encoder = new TextEncoder();
    const data = encoder.encode(codeVerifier);
    const hashBuffer = await crypto.subtle.digest("SHA-256", data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    const base64url = btoa(String.fromCharCode(...hashArray))
      .replace(/\+/g, "-").replace(/\//g, "_").replace(/=+$/, "");

    const authURL = `https://auth.staging.ultra.io/auth/realms/ultraio/protocol/openid-connect/auth?response_type=code&client_id=2f6ca3c9-87ec-4042-a464-21349485a16f&redirect_uri=https://nathanogaga118.github.io/ultra-poc/callback.html&scope=openid&code_challenge=${base64url}&code_challenge_method=S256&nonce=random123&state=secureState456`;

    window.location.href = authURL; // Go to login
  }

  startLogin();
</script>
